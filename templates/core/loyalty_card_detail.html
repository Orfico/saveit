{% extends 'base.html' %}
{% load static %}

{% block title %}{{ card.store_name }} - Barcode{% endblock %}

{% block extra_head %}
<meta name="csrf-token" content="{{ csrf_token }}">
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    
    <!-- Back Button -->
    <div class="mb-6">
        <a href="{% url 'core:loyalty_cards_list' %}" 
           class="text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2">
            <i data-lucide="arrow-left" class="w-4 h-4"></i>
            Back to Cards
        </a>
    </div>
    
    <!-- Card Display -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 px-8 py-6 text-white">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold flex items-center gap-3">
                        <i data-lucide="store" class="w-8 h-8"></i>
                        {{ card.store_name }}
                    </h1>
                    <p class="text-blue-100 mt-2 flex items-center gap-2">
                        <i data-lucide="barcode" class="w-4 h-4"></i>
                        <span class="font-mono text-lg">{{ card.card_number }}</span>
                    </p>
                </div>
                <span class="bg-white text-blue-600 px-4 py-2 rounded-full font-semibold">
                    {{ card.get_barcode_type_display }}
                </span>
            </div>
        </div>
        
        <!-- Barcode Display -->
        <div class="p-8 bg-gray-50">
            <div class="bg-white rounded-lg shadow-md p-8 text-center">
                {% if card.barcode_image %}
                    <img id="barcode-image" 
                         src="{{ card.barcode_image.url }}" 
                         alt="Barcode {{ card.store_name }}"
                         class="mx-auto max-w-full border-4 border-gray-200 rounded-lg p-6 bg-white"
                         data-url="{{ card.barcode_image.url }}"
                         data-store="{{ card.store_name }}"
                         data-number="{{ card.card_number }}">
                {% else %}
                    <div class="py-12">
                        <i data-lucide="alert-circle" class="w-16 h-16 mx-auto text-gray-300 mb-4"></i>
                        <p class="text-gray-600">Barcode not available</p>
                    </div>
                {% endif %}
                
                <!-- Large code display -->
                <div class="mt-6 p-4 bg-gray-100 rounded-lg">
                    <p class="text-3xl font-mono font-bold text-gray-900">
                        {{ card.card_number }}
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Info & Notes -->
        <div class="px-8 py-6 border-t border-gray-200">
            {% if card.notes %}
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-2 flex items-center gap-2">
                    <i data-lucide="sticky-note" class="w-5 h-5 text-blue-600"></i>
                    Notes
                </h3>
                <p class="text-gray-700 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                    {{ card.notes }}
                </p>
            </div>
            {% endif %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                <div class="flex items-center gap-2">
                    <i data-lucide="calendar-plus" class="w-4 h-4 text-gray-400"></i>
                    <span>Created: <strong>{{ card.created_at|date:"m/d/Y H:i" }}</strong></span>
                </div>
                <div class="flex items-center gap-2">
                    <i data-lucide="calendar-clock" class="w-4 h-4 text-gray-400"></i>
                    <span>Updated: <strong>{{ card.updated_at|date:"m/d/Y H:i" }}</strong></span>
                </div>
            </div>
        </div>
        
        <!-- Actions -->
        <div class="px-8 py-6 bg-gray-50 border-t border-gray-200 flex flex-wrap gap-3">
            <button onclick="window.print()" 
                    class="flex-1 md:flex-none bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                <i data-lucide="printer" class="w-4 h-4"></i>
                Print
            </button>
            
            <button onclick="downloadBarcode()" 
                    class="flex-1 md:flex-none bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                <i data-lucide="download" class="w-4 h-4"></i>
                Download
            </button>
            
            <button onclick="shareBarcode()" 
                    class="flex-1 md:flex-none bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                <i data-lucide="share-2" class="w-4 h-4"></i>
                Share
            </button>
            
            <button id="delete-btn" 
                    onclick="confirmDelete()" 
                    data-card-id="{{ card.id }}"
                    class="flex-1 md:flex-none bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
                Delete
            </button>
        </div>
    </div>
    
    <!-- Tips -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="font-semibold text-blue-900 mb-2 flex items-center gap-2">
            <i data-lucide="lightbulb" class="w-5 h-5"></i>
            Tips
        </h3>
        <ul class="text-sm text-blue-800 space-y-2">
            <li class="flex items-start gap-2">
                <span class="text-blue-600 mt-0.5">•</span>
                <span>Use "Print" to get a physical copy of your barcode</span>
            </li>
            <li class="flex items-start gap-2">
                <span class="text-blue-600 mt-0.5">•</span>
                <span>Show the barcode directly from your smartphone at checkout</span>
            </li>
            <li class="flex items-start gap-2">
                <span class="text-blue-600 mt-0.5">•</span>
                <span>Increase screen brightness for easier scanning</span>
            </li>
        </ul>
    </div>
    
</div>

<!-- Print Styles -->
<style>
@media print {
    body * {
        visibility: hidden;
    }
    
    .bg-white.rounded-lg.shadow-md,
    .bg-white.rounded-lg.shadow-md * {
        visibility: visible;
    }
    
    .bg-white.rounded-lg.shadow-md {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        box-shadow: none !important;
    }
    
    nav, .back-button, .bg-gray-50, .tips {
        display: none !important;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script src="{% static 'core/js/loyalty_card_detail.js' %}"></script>
{% endblock %}