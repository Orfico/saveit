name: Generate Recurring Transactions

on:
  schedule:
    # Run at 02:00 UTC every day
    - cron: '0 2 * * *'
  
  # Allow manual triggering of the workflow from the Actions tab
  workflow_dispatch:

jobs:
  generate-transactions:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‹ Checkout repository
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
      
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: ğŸ”„ Generate recurring transactions
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          SECRET_KEY: ${{ secrets.SECRET_KEY }}
          DEBUG: 'False'
          ALLOWED_HOSTS: 'github-actions'
        run: |
          python manage.py generate_recurring_transactions
      
      - name: âœ… Success notification
        if: success()
        run: |
          echo "âœ… Recurring transactions generated successfully"
          echo "â° Run date: $(date)"
          echo "ğŸ“Š Next execution: tomorrow"
      
      - name: âŒ Failure notification
        if: failure()
        run: |
          echo "âŒ Error in generating recurring transactions"
          echo "ğŸ” Check the logs above for details"
          exit 1
